<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Universal CNC Spindle Motor Controller: motorEncoder Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Universal CNC Spindle Motor Controller
   &#160;<span id="projectnumber">Version 1.0</span>
   </div>
   <div id="projectbrief">Interfaces Standard 110v routers with a Stm32 Nucleo Microcontroller</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="classmotorEncoder-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">motorEncoder Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Defines the class for an <a class="el" href="classEncoder.html" title="Defines the class for an Encoder.">Encoder</a>.  
 <a href="classmotorEncoder.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="encoder_8h_source.html">encoder.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a179d6e487935b66bcbc9ba7f785e315d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotorEncoder.html#a179d6e487935b66bcbc9ba7f785e315d">motorEncoder</a> (uint8_t A_pin, uint8_t B_pin)</td></tr>
<tr class="memdesc:a179d6e487935b66bcbc9ba7f785e315d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function called to instantiate an encoder object.  <a href="classmotorEncoder.html#a179d6e487935b66bcbc9ba7f785e315d">More...</a><br /></td></tr>
<tr class="separator:a179d6e487935b66bcbc9ba7f785e315d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a183266abbc9917aefc22b569ee57bef0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmotorEncoder.html#a183266abbc9917aefc22b569ee57bef0">update</a> (uint32_t timestamp, bool dir)</td></tr>
<tr class="memdesc:a183266abbc9917aefc22b569ee57bef0"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function calculates the speed of the motor.  <a href="classmotorEncoder.html#a183266abbc9917aefc22b569ee57bef0">More...</a><br /></td></tr>
<tr class="separator:a183266abbc9917aefc22b569ee57bef0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:ab123867c3179d395e12f463e930b147f"><td class="memItemLeft" align="right" valign="top"><a id="ab123867c3179d395e12f463e930b147f"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>motorSpeed</b></td></tr>
<tr class="separator:ab123867c3179d395e12f463e930b147f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73217a472715f00eab1cc3555be2e553"><td class="memItemLeft" align="right" valign="top"><a id="a73217a472715f00eab1cc3555be2e553"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>counts_per_rev</b></td></tr>
<tr class="separator:a73217a472715f00eab1cc3555be2e553"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91d1ba1812150cfa4122664875d2baff"><td class="memItemLeft" align="right" valign="top"><a id="a91d1ba1812150cfa4122664875d2baff"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>update_frequency</b></td></tr>
<tr class="separator:a91d1ba1812150cfa4122664875d2baff"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:a324a5fe2be21fd80000f7ea01a981f58"><td class="memItemLeft" align="right" valign="top"><a id="a324a5fe2be21fd80000f7ea01a981f58"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>A_pin</b></td></tr>
<tr class="separator:a324a5fe2be21fd80000f7ea01a981f58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e61e4da4008a5f4ebee983db8e6f0c8"><td class="memItemLeft" align="right" valign="top"><a id="a3e61e4da4008a5f4ebee983db8e6f0c8"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>B_pin</b></td></tr>
<tr class="separator:a3e61e4da4008a5f4ebee983db8e6f0c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a896cf6c99813751e91b5ef65b212e534"><td class="memItemLeft" align="right" valign="top"><a id="a896cf6c99813751e91b5ef65b212e534"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>count</b></td></tr>
<tr class="separator:a896cf6c99813751e91b5ef65b212e534"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcdbd83f2c342add50b55203884a71c1"><td class="memItemLeft" align="right" valign="top"><a id="afcdbd83f2c342add50b55203884a71c1"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>timestamp_previous_interrupt</b></td></tr>
<tr class="separator:afcdbd83f2c342add50b55203884a71c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5587b5506d948d5434688869a677fa6b"><td class="memItemLeft" align="right" valign="top"><a id="a5587b5506d948d5434688869a677fa6b"></a>
volatile float&#160;</td><td class="memItemRight" valign="bottom"><b>speed_RPM</b></td></tr>
<tr class="separator:a5587b5506d948d5434688869a677fa6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1881cf27d393e8196da8a493fb0127b4"><td class="memItemLeft" align="right" valign="top"><a id="a1881cf27d393e8196da8a493fb0127b4"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>count_previous_interrupt</b></td></tr>
<tr class="separator:a1881cf27d393e8196da8a493fb0127b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84bbfba5a604f6c4ac95b1478fdf0a8c"><td class="memItemLeft" align="right" valign="top"><a id="a84bbfba5a604f6c4ac95b1478fdf0a8c"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>direction</b></td></tr>
<tr class="separator:a84bbfba5a604f6c4ac95b1478fdf0a8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51e2708cee387c7f4d088b6d7741aaea"><td class="memItemLeft" align="right" valign="top"><a id="a51e2708cee387c7f4d088b6d7741aaea"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>counts_until_update</b></td></tr>
<tr class="separator:a51e2708cee387c7f4d088b6d7741aaea"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Defines the class for an <a class="el" href="classEncoder.html" title="Defines the class for an Encoder.">Encoder</a>. </p>
<p>This class has several protected attributes, which are mostly used in calculating the speed of the motor. When instantiating an <a class="el" href="classEncoder.html" title="Defines the class for an Encoder.">Encoder</a> object, the user must specify which hardware pins to use. The user also has the ability to change the frequency at which the motor speed is updated to the user. The user must also specify the resolution of their encoder, i.e. how many ticks per revolution it will trigger. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a179d6e487935b66bcbc9ba7f785e315d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a179d6e487935b66bcbc9ba7f785e315d">&#9670;&nbsp;</a></span>motorEncoder()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">motorEncoder::motorEncoder </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>A_GPIO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>B_GPIO</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function called to instantiate an encoder object. </p>
<p>This function requires two parameters to instantiate an encoder object. The first parameter is the hardware pin to read signal A, and the second parameter is the hardware pin to read signal B. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a183266abbc9917aefc22b569ee57bef0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a183266abbc9917aefc22b569ee57bef0">&#9670;&nbsp;</a></span>update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void motorEncoder::update </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>timestamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>dir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function calculates the speed of the motor. </p>
<p>After the direction of the motor is determined in the ISR, this function calculates the motor's speed. It keeps track of the absolute position of the motor, in encoder ticks, with a protected attribute called "count". Each encoder tick in the forward direction adds 1 to count, and each encoder tick in the reverse direction subtracts 1 from count. Although this function is called every interrupt, it does not calculate the motor speed every interrupt. Rather, it calculates the motor speed every update_frequency interrupts. To do this, this function calculates the number of encoder counts between calculations, and the elapsed time between calculations. This uses protected attributes: timestamp_previous_interrupt, and count_previous_interrupt. The speed, in RPM, is calculated using the equation below. Units are noted in "[ ]"</p>
<p>Speed [RPM] = (delta_count/delta_time)[counts/microsecond]*1000000[microseconds/second]</p><ul>
<li>60 [seconds/min] / (counts_per_rev) [counts/revolution] </li>
</ul>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="encoder_8h_source.html">encoder.h</a></li>
<li><a class="el" href="encoder_8cpp.html">encoder.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
